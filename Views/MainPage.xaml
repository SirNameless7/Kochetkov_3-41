<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:KPO_Cursovoy.ViewModels"
             x:Class="KPO_Cursovoy.Views.MainPage"
             Title="Каталог ПК"
             BackgroundColor="#020617">

    <ScrollView>
        <Grid Padding="24"
              RowDefinitions="Auto,Auto,*"
              BackgroundColor="#020617">

            <VerticalStackLayout Grid.Row="0" Spacing="4">
                <Label Text="Каталог готовых ПК"
                       FontSize="28"
                       FontAttributes="Bold"
                       TextColor="#F9FAFB" />
                <Label Text="Выберите готовый ПК или соберите свой"
                       FontSize="14"
                       TextColor="#9CA3AF" />
            </VerticalStackLayout>

            <HorizontalStackLayout Grid.Row="1"
                                   Margin="0,20,0,24"
                                   Spacing="12">
                <Button Text="Собрать ПК"
                        Command="{Binding BuildPcCommand}"
                        BackgroundColor="#2563EB"
                        TextColor="White"
                        CornerRadius="10"
                        Padding="18,8" />
                <Button Text="Корзина"
                        Command="{Binding NavigateToCartCommand}"
                        BackgroundColor="#16A34A"
                        TextColor="White"
                        CornerRadius="10"
                        Padding="18,8" />
            </HorizontalStackLayout>

            <RefreshView Grid.Row="2"
                         Command="{Binding LoadDataCommand}"
                         IsRefreshing="{Binding IsBusy}">
                <CollectionView ItemsSource="{Binding PcItems}"
                                SelectionMode="None">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Frame Padding="16"
                                   Margin="0,0,0,4"
                                   CornerRadius="12"
                                   HasShadow="True"
                                   BackgroundColor="#020617"
                                   BorderColor="#1F2937">
                                <Grid ColumnDefinitions="Auto,*"
                                      RowDefinitions="Auto,Auto,Auto,Auto"
                                      ColumnSpacing="16"
                                      RowSpacing="4">

                                    <Image Source="pc_thumbnail.png"
                                           Grid.RowSpan="4"
                                           WidthRequest="96"
                                           HeightRequest="96"
                                           Aspect="AspectFit" />

                                    <Label Grid.Column="1"
                                           Text="{Binding Name}"
                                           FontSize="18"
                                           FontAttributes="Bold"
                                           TextColor="#F9FAFB" />

                                    <Label Grid.Column="1"
                                           Grid.Row="1"
                                           Text="{Binding Description}"
                                           TextColor="#9CA3AF"
                                           FontSize="13"
                                           LineBreakMode="WordWrap" />

                                    <Label Grid.Column="1"
                                           Grid.Row="2"
                                           Text="{Binding Price, StringFormat='₽{0:N0}'}"
                                           TextColor="#22C55E"
                                           FontAttributes="Bold"
                                           FontSize="20"
                                           Margin="0,4,0,0" />

                                    <HorizontalStackLayout Grid.Column="1"
                                                           Grid.Row="3"
                                                           Spacing="8"
                                                           Margin="0,8,0,0">
                                        <Button Text="Подробнее"
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type vm:MainPageViewModel}},
                                                                  Path=SelectPcCommand}"
                                                CommandParameter="{Binding}"
                                                BackgroundColor="Transparent"
                                                TextColor="#60A5FA"
                                                FontAttributes="Bold"
                                                Padding="8,4" />
                                        <Button Text="Купить"
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type vm:MainPageViewModel}},
                                                                  Path=AddToCartCommand}"
                                                CommandParameter="{Binding}"
                                                BackgroundColor="#2563EB"
                                                TextColor="White"
                                                CornerRadius="8"
                                                Padding="14,4" />
                                    </HorizontalStackLayout>

                                </Grid>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>

                    <CollectionView.EmptyView>
                        <VerticalStackLayout Spacing="10"
                                             Padding="0,40,0,0"
                                             HorizontalOptions="Center">
                            <Image Source="no_items.png"
                                   HeightRequest="120"
                                   HorizontalOptions="Center" />
                            <Label Text="Готовые ПК отсутствуют"
                                   FontSize="18"
                                   TextColor="#9CA3AF"
                                   HorizontalOptions="Center" />
                            <Label Text="Попробуйте собрать ПК самостоятельно"
                                   TextColor="#6B7280"
                                   HorizontalOptions="Center" />
                            <Button Text="Собрать ПК"
                                    Command="{Binding BuildPcCommand}"
                                    BackgroundColor="#2563EB"
                                    TextColor="White"
                                    CornerRadius="10"
                                    Padding="18,8"
                                    Margin="0,10,0,0"
                                    HorizontalOptions="Center" />
                        </VerticalStackLayout>
                    </CollectionView.EmptyView>
                </CollectionView>
            </RefreshView>
        </Grid>
    </ScrollView>
</ContentPage>
